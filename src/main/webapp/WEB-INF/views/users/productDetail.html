<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <!-- ë ˆì´ì•„ì›ƒ(header/footer) ì „ìš© CSS -->
    <link rel="stylesheet" href="../../css/layout.css" />
    <!-- ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ ì „ìš© CSS -->
    <link rel="stylesheet" href="../../css/productDetail.css" />

    <title>productDetail</title>
</head>

<body>
    <!-- ë ˆì´ì•„ì›ƒ í…œí”Œë¦¿-->
    <div id="wrapper"></div>
    <script type="text/template" id="productDetail-template">
    <main>
            <!-- ì´ë¯¸ì§€ ì˜ì—­ -->
            <div class="storeDetailImg">
                <div class="storeImgSlider">
                    <div class="sliderTrack">
                        <img src="../img/user_store1.jpg" alt="Store Image 1" class="sliderImg">
                        <img src="../img/user_store2.jpg" alt="Store Image 2" class="sliderImg">
                        <img src="../img/user_store3.jpg" alt="Store Image 3" class="sliderImg">
                        <img src="../img/user_store1.jpg" alt="Store Image 1" class="sliderImg">
                        <img src="../img/user_store2.jpg" alt="Store Image 2" class="sliderImg">
                    </div>
                    <div class="sliderIndicators"></div>
                </div>

                <!-- ì œí’ˆëª…/ê°€ê²© í—¤ë” -->
                <div class="storeHeader">
                    <div class="storeName">ëŸ¬í”„ë„ìš°</div>
                    <div class="statusBadge" data-status="soldout">ë§¤ì§„(17:30)</div> <!--ìƒíƒœ ì—…ë°ì´íŠ¸-->
                    <div class="productPrice">
                        <span class="original">5,500 â‚©</span>
                        <span class="discounted">2,650 â‚©</span>
                    </div>
                </div>
            </div>

            <!-- ìƒì„¸ ì •ë³´ ì˜ì—­ -->
            <div class="storeDetailInfo">
            <div class="productInfo">

                <!-- íƒ­ ë©”ë‰´ -->
                <div class="tabs">
                <button class="tab active">ì˜¤êµ¿ë°± ì •ë³´</button>
                <button class="tab">ë¦¬ë·°(73ê°œ)</button>
                </div>

                <div class="infoContent">
                <!-- ë§¤ì¥ ì •ë³´ -->
                <div class="storeInfo">
                    <div class="infoRow">
                    <span class="pickup">í”½ì—… ì‹œê°„</span>
                    <span class="pickupdiv">|</span>
                    <span class="pickupTime">19:00 ~ 19:30</span>
                    <span class="confirm">í™•ì • ì‹œê°„</span>
                    <span class="confirmdiv">|</span>
                    <span class="confirmTime">18:30</span>
                    </div>
                    <div class="note">
                    * í”½ì—…ì‹œê°„ ì´ì „/ì´í›„ì— ë°©ë¬¸í•˜ëŠ” ê±´ ì‚¬ì¥ë‹˜ì„ í˜ë“¤ê²Œí•´ìš”<br>
                    * í™•ì •ì‹œê°„ ì „ì—ëŠ” ê°€ê²Œ ìƒí™©ì— ë”°ë¼, ì˜ˆì•½ì´ ì·¨ì†Œë  ìˆ˜ ìˆì–´ìš”.<br>
                    * ì·¨ì†Œì‹œ, 100% í™˜ë¶ˆì´ ê°€ëŠ¥í•´ìš”
                    </div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ ì •ë³´ -->
                <div class="categorySection">
                    <li class="infoRow">
                    <span class="infoLabel">ì¹´í…Œê³ ë¦¬</span>
                    <span class="pickupdiv">|</span>
                    <span class="infoValue">ë¹µ & ë””ì €íŠ¸</span>
                    </li>
                    <li class="infoRow">
                    <span class="infoLabel">ëŒ€í‘œë©”ë‰´</span>
                    <span class="pickupdiv">|</span>
                    <span class="infoValue">ì»µì¼€ì´í¬, ë°”ê²ŒíŠ¸, ì¹˜ì•„ë°”íƒ€</span>
                    </li>
                    <li class="infoRow">
                    <span class="infoLabel">ì˜ì—…ì‹œê°„</span>
                    <span class="pickupdiv">|</span>
                    <span class="infoValue">09:00 ~ 20:00</span>
                    </li>
                    <div class="addRow">
                    <span class="addLabel">ğŸ“</span>
                    <span class="addValue">ë…¸ì›êµ¬ ê³µë¦‰ë™ 470</span>
                    <span class="addLabel">ğŸ“</span>
                    <span class="addValue">102-1234-5678</span>
                    </div>
                    <div class="note2">
                    ë‹¤ìŒ ì‚¬ì•ˆ í•´ë‹¹ì‹œ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”.<br>
                    1. í™•ì • ì‹œê°„ ì „ ì·¨ì†Œì— ëŒ€í•œ í•­ì˜ 2. í”½ì—… ì‹œê°„ ì™¸ ë°©ë¬¸ ìš”êµ¬<br>
                    </div>
                </div>

                <!-- ì£¼ë¬¸ ë²„íŠ¼ -->
                <div id="orderArea"></div>
                </div>
                <!-- /infoContent ë -->

                <!--  ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ (ê¸°ë³¸ ìˆ¨ê¹€) -->
                <div class="reviewSection" >
                <div class="reviewList">
                    <!-- ì‹¤ì œë¡œëŠ” AJAX ë¡œë”© í›„ append ë  ë¶€ë¶„ -->
                    <!-- ì˜ˆì‹œ í•˜ë“œì½”ë”©  -->
                    <div class="overlap">
                    <div class="reviewBox"></div>
                    <div class="reviewerName">í¬ë¡±</div>
                    <div class="reviewedDate">2025.06.11</div>
                    <img class="reviewImage" src="../img/pain.png" alt="ë¦¬ë·° ì´ë¯¸ì§€" />
                    <hr class="line" />
                    <p class="reviewContent">
                        ì„±ìˆ˜ë™ ìµœê³ ì˜ ë¹µì§‘!<br>
                        íœ˜ë‚­ì‹œì—ì™€ ì¿ í‚¤ê°€ ì •ë§ ë§›ìˆì–´ìš”.<br>
                    </p>
                    </div>
                    <div class="overlap">
                    <div class="reviewBox"></div>
                    <div class="reviewerName">í¬ë¡±</div>
                    <div class="reviewedDate">2025.06.11</div>
                    <img class="reviewImage" src="../img/pain.png" alt="ë¦¬ë·° ì´ë¯¸ì§€" />
                    <hr class="line" />
                    <p class="reviewContent">
                        ì„±ìˆ˜ë™ ìµœê³ ì˜ ë¹µì§‘!<br>
                        íœ˜ë‚­ì‹œì—ì™€ ì¿ í‚¤ê°€ ì •ë§ ë§›ìˆì–´ìš”.
                    </p>
                    </div>
                    <div class="overlap">
                    <div class="reviewBox"></div>
                    <div class="reviewerName">í¬ë¡±</div>
                    <div class="reviewedDate">2025.06.11</div>
                    <img class="reviewImage" src="../img/pain.png" alt="ë¦¬ë·° ì´ë¯¸ì§€" />
                    <hr class="line" />
                    <p class="reviewContent">
                        ì„±ìˆ˜ë™ ìµœê³ ì˜ ë¹µì§‘!<br>
                        íœ˜ë‚­ì‹œì—ì™€ ì¿ í‚¤ê°€ ì •ë§ ë§›ìˆì–´ìš”.
                    </p>
                    </div>                    
                    <div class="overlap">
                    <div class="reviewBox"></div>
                    <div class="reviewerName">í¬ë¡±</div>
                    <div class="reviewedDate">2025.06.11</div>
                    <img class="reviewImage" src="../img/pain.png" alt="ë¦¬ë·° ì´ë¯¸ì§€" />
                    <hr class="line" />
                    <p class="reviewContent">
                        ì„±ìˆ˜ë™ ìµœê³ ì˜ ë¹µì§‘!<br>
                        íœ˜ë‚­ì‹œì—ì™€ ì¿ í‚¤ê°€ ì •ë§ ë§›ìˆì–´ìš”.
                    </p>
                    </div>
                </div>
                <div id="reviewLoader" style="text-align:center;padding:12px;display:none;">
                    ë¡œë”© ì¤‘â€¦
                </div>
                </div>

            </div>
            </div>

        </main>
    </script>

</body>
<!-- ë ˆì´ì•„ì›ƒ ë¡œë“œ + í…œí”Œë¦¿ ì‚½ì… ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    $(function () {
        $("#wrapper").load("layout.html #wrapper", function () {
            // 1) main ì´ˆê¸°í™” & í…œí”Œë¦¿ ì‚½ì…
            var $main = $("#wrapper").find("main")
                .addClass("productDetail storeDetailInfo")
                .empty()
                .append($("#productDetail-template").html());

            // 2) ì£¼ë¬¸ ì˜ì—­ í”Œë ˆì´ìŠ¤í™€ë” ë³€ìˆ˜
            var $orderArea = $main.find("#orderArea");

            // 3) ìƒíƒœ ë°°ì§€ ì…‹ì—…
            var $badge = $main.find(".statusBadge");
            var status = $badge.data("status"); // "soldout" or "available"

            if (status === "soldout") {
                $badge.removeClass("available").addClass("soldout").text("ë§¤ì§„(17:30)");
                $orderArea.html('<div class="orderSoldout">ë§ˆê°</div>');
            } else {
                $badge.removeClass("soldout").addClass("available").text("íŒë§¤ì¤‘");
                $orderArea.html('<button class="orderButton">êµ¬ë§¤í•˜ê¸°(3ê°œ ë‚¨ìŒ)</button>');
            }

            // 4) ë©”ë‰´ë°” í™œì„±í™”
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function () {
                    document.querySelectorAll('.menu-item').forEach(i => {
                        i.classList.remove('active');
                        i.querySelector('img').src = `../img/${i.querySelector('img').dataset.name}.png`;
                    });
                    this.classList.add('active');
                    this.querySelector('img').src = `../img/${this.querySelector('img').dataset.name}_active.png`;
                });
            });

            // 4-1) íƒ­ í´ë¦­ ì´ë²¤íŠ¸
            $main.find('.tabs .tab').click(function () {
                var idx = $(this).index();
                $main.find('.tabs .tab').removeClass('active').eq(idx).addClass('active');

                if (idx === 0) {
                    // ì •ë³´ íƒ­
                    $main.find('.infoContent').show();
                    $main.find('.reviewSection').hide();
                } else {
                    // ë¦¬ë·° íƒ­
                    $main.find('.infoContent').hide();
                    $main.find('.reviewSection').show();
                }
            });



            // ìŠ¬ë¼ì´ë” ì„¤ì •
            initSlider();

            // ë¦¬ë·° ë¬´í•œ ìŠ¤í¬ë¡¤ ì„¤ì •
            setupReviewInfiniteScroll();
        });

        // --- ìŠ¬ë¼ì´ë” ë¡œì§ ---
        // ì „ì—­ ë³€ìˆ˜
        let track, images, indicators, currentIndex = 0;

        function initSlider() {
            track = document.querySelector('.sliderTrack');
            images = document.querySelectorAll('.sliderTrack .sliderImg');
            indicators = document.querySelector('.sliderIndicators');
            currentIndex = 0;
            createIndicators();
            showSlide(0);
        }

        function createIndicators() {
            indicators.innerHTML = '';
            images.forEach((_, i) => {
                const dot = document.createElement('div');
                dot.className = 'sliderIndicator';
                dot.addEventListener('click', () => showSlide(i));
                indicators.appendChild(dot);
            });
        }

        function showSlide(idx) {
            currentIndex = (idx + images.length) % images.length;
            track.style.transition = 'transform 0.3s ease';
            track.style.transform = `translateX(-${currentIndex * 100}%)`;
            // active indicator
            indicators.querySelectorAll('.sliderIndicator').forEach((d, i) => {
                d.classList.toggle('active', i === currentIndex);
            });
        }

        // ë¦¬ë·° ë¬´í•œ ìŠ¤í¬ë¡¤
        function setupReviewInfiniteScroll() {
            var reviewPage = 1;
            var reviewLoading = false;
            var reviewEnd = false;
            var $reviewSec = $("#wrapper").find(".reviewSection");
            var $reviewList = $reviewSec.find(".reviewList");
            var $loader = $('<div id="reviewLoader" style="text-align:center;padding:12px;display:none;">ë¡œë”© ì¤‘â€¦</div>')
                .appendTo($reviewSec);

            // íƒ­ í´ë¦­ ì‹œ ì²« ë¡œë“œ
            $("#wrapper").find('.tabs .tab').click(function () {
                if ($(this).index() === 1 && reviewPage === 1) {
                    loadReviews();
                }
            });

            // ìŠ¤í¬ë¡¤ ë ê°ì§€
            $reviewSec.on('scroll', function () {
                if (!reviewLoading && !reviewEnd
                    && $reviewSec.scrollTop() + $reviewSec.innerHeight() >= $reviewSec[0].scrollHeight - 50) {
                    loadReviews();
                }
            });

            // ë¦¬ë·° ë¡œë“œ í•¨ìˆ˜
            function loadReviews() {
                reviewLoading = true;
                $loader.show();

                $.ajax({
                    url: '/api/reviews',       // ì‹¤ì œ API ì—”ë“œí¬ì¸íŠ¸
                    data: { page: reviewPage },
                    success: function (res) {
                        if (res.reviews && res.reviews.length) {
                            res.reviews.forEach(function (r) {
                                var item =
                                    '<div class="overlap">' +
                                    '<div class="reviewBox"></div>' +
                                    '<div class="reviewerName">' + r.author + '</div>' +
                                    '<div class="reviewedDate">' + r.date + '</div>' +
                                    '<img class="reviewImage" src="' + r.image + '" alt="ë¦¬ë·° ì´ë¯¸ì§€" />' +
                                    '<hr class="line" />' +
                                    '<p class="reviewContent">' + r.text + '</p>' +
                                    '<div class="storeBox"></div>' +
                                    '<div class="storeName">' + r.storeName + '</div>' +
                                    '<img class="storeImage" src="' + r.storeImage + '" alt="ë§¤ì¥ ì´ë¯¸ì§€" />' +
                                    '<p class="storeMenu"><span class="span">' + r.menu + '</span></p>' +
                                    '<div class="price">' +
                                    '<span class="originPrice">' + r.originalPrice + ' â‚©</span>' +
                                    '<span class="salePrice">' + r.salePrice + ' â‚©</span>' +
                                    '</div>' +
                                    '</div>';
                                $reviewList.append(item);
                            });
                            reviewPage++;
                        } else {
                            reviewEnd = true;
                            $loader.text('ë” ì´ìƒ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤');
                        }
                    },
                    error: function () {
                        $loader.text('ë¦¬ë·° ë¡œë“œ ì‹¤íŒ¨');
                    },
                    complete: function () {
                        reviewLoading = false;
                        if (!reviewEnd) $loader.hide();
                    }
                });
            }
        }
    });
</script>


</html>